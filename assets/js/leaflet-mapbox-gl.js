!function(t,i){"function"==typeof define&&define.amd?define(["leaflet","mapbox-gl"],i):"object"==typeof exports?module.exports=i(require("leaflet"),require("mapbox-gl")):t.returnExports=i(window.L,window.mapboxgl)}(this,function(s,r){s.MapboxGL=s.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1},initialize:function(t){s.setOptions(this,t),t.accessToken&&(r.accessToken=t.accessToken),this._throttledUpdate=s.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(t){this._container||this._initContainer(),t.getPanes().tilePane.appendChild(this._container),this._initGL(),this._offset=this._map.containerPointToLayerPoint([0,0]),t.options.zoomAnimation&&s.DomEvent.on(t._proxy,s.DomUtil.TRANSITION_END,this._transitionEnd,this)},onRemove:function(t){this._map._proxy&&this._map.options.zoomAnimation&&s.DomEvent.off(this._map._proxy,s.DomUtil.TRANSITION_END,this._transitionEnd,this),t.getPanes().tilePane.removeChild(this._container),this._glMap.remove(),this._glMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getMapboxMap:function(){return this._glMap},getCanvas:function(){return this._glMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+2*this.options.padding)},getBounds:function(){var t=this.getSize().multiplyBy(.5),i=this._map.latLngToContainerPoint(this._map.getCenter());return s.latLngBounds(this._map.containerPointToLatLng(i.subtract(t)),this._map.containerPointToLatLng(i.add(t)))},getContainer:function(){return this._container},_initContainer:function(){var t=this._container=s.DomUtil.create("div","leaflet-gl-layer"),i=this.getSize(),n=this._map.getSize().multiplyBy(this.options.padding),i=(t.style.width=i.x+"px",t.style.height=i.y+"px",this._map.containerPointToLayerPoint([0,0]).subtract(n));s.DomUtil.setPosition(t,i)},_initGL:function(){var t=this._map.getCenter(),t=s.extend({},this.options,{container:this._container,center:[t.lng,t.lat],zoom:this._map.getZoom()-1,attributionControl:!1}),t=(this._glMap=new r.Map(t),this._glMap.transform.latRange=null,this._glMap._canvas.canvas?this._glMap._actualCanvas=this._glMap._canvas.canvas:this._glMap._actualCanvas=this._glMap._canvas,this._glMap._actualCanvas);s.DomUtil.addClass(t,"leaflet-image-layer"),s.DomUtil.addClass(t,"leaflet-zoom-animated"),this.options.interactive&&s.DomUtil.addClass(t,"leaflet-interactive"),this.options.className&&s.DomUtil.addClass(t,this.options.className)},_update:function(t){var i,n,o,e,a;this._offset=this._map.containerPointToLayerPoint([0,0]),this._zooming||(i=this.getSize(),n=this._container,o=this._glMap,e=this._map.getSize().multiplyBy(this.options.padding),e=this._map.containerPointToLayerPoint([0,0]).subtract(e),s.DomUtil.setPosition(n,e),e=this._map.getCenter(),(a=o.transform).center=r.LngLat.convert([e.lng,e.lat]),a.zoom=this._map.getZoom()-1,o.transform.width!==i.x||o.transform.height!==i.y?(n.style.width=i.x+"px",n.style.height=i.y+"px",null!==o._resize&&void 0!==o._resize?o._resize():o.resize()):null!==o._update&&void 0!==o._update?o._update():o.update())},_pinchZoom:function(t){this._glMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(t){var i=this._map.getZoomScale(t.zoom),n=this._map.getSize().multiplyBy(this.options.padding*i),o=this.getSize()._divideBy(2),o=this._map.project(t.center,t.zoom)._subtract(o)._add(this._map._getMapPanePos().add(n))._round(),n=this._map.project(this._map.getBounds().getNorthWest(),t.zoom)._subtract(o);s.DomUtil.setTransform(this._glMap._actualCanvas,n.subtract(this._offset),i)},_zoomStart:function(t){this._zooming=!0},_zoomEnd:function(){var t=this._map.getZoomScale(this._map.getZoom()),i=this._map._latLngToNewLayerPoint(this._map.getBounds().getNorthWest(),this._map.getZoom(),this._map.getCenter());s.DomUtil.setTransform(this._glMap._actualCanvas,i.subtract(this._offset),t),this._zooming=!1,this._update()},_transitionEnd:function(t){s.Util.requestAnimFrame(function(){var t=this._map.getZoom(),i=this._map.getCenter(),n=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());s.DomUtil.setTransform(this._glMap._actualCanvas,n,1),this._glMap.once("moveend",s.Util.bind(function(){this._zoomEnd()},this)),this._glMap.jumpTo({center:i,zoom:t-1})},this)},_resize:function(t){this._transitionEnd(t)}}),s.mapboxGL=function(t){return new s.MapboxGL(t)}});