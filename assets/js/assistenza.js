!function(){let e=document.querySelector(".container-assistenza");async function t(e){try{let t=await fetch(`${window.wpRestApi}wp/v2/servizi${e?`?categorie_servizio=${e}`:""}`),r=await t.json();return r}catch(n){console.error(n)}}async function r(){try{let t=e.querySelector('[name="name"]').value,r=e.querySelector('[name="surname"]').value,n=e.querySelector('[name="email"]').value,a=e.querySelector("#category").value,l=function e(t){let r=new DOMParser,n=r.parseFromString(t,"text/html").documentElement.textContent;return escapeHTML(n)}(e.querySelector("#service").value),i=e.querySelector("#description").value,o=e.querySelector("#privacy").checked,c={title:`ticket_${new Date().toISOString()}`,nome:t,cognome:r,email:n,categoria_servizio:a,servizio:l,dettagli:i,privacyChecked:o},s=Object.values(c)?.filter(e=>!e);if(s?.length>0||!/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(n))return!1;let u=await fetch(data_assistenza.url,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"},body:new URLSearchParams({action:"save_richiesta_assistenza",...c})});return u.ok}catch(d){console.error(d)}}async function n(){let n=e.querySelector(".steppers-content");if(!n)return;let a=n.querySelector("#category");if(!a)return;let l=n.querySelector("#service");l&&(a.addEventListener("change",async e=>{!function e(t){let r=t.firstElementChild;t.innerHTML="",t.append(r),t.disabled=!0}(l);let r=e.target.value;if(!r)return;let n=await t(r);if(Array.isArray(n)){for(servizio of n){let a=servizio?.title?.rendered,i=document.createElement("option");i.value=a,i.innerHTML=a,l.add(i)}l.childElementCount>1&&(l.disabled=!1)}}),n.addEventListener("submit",async()=>{let t=n.querySelector(".errorFeedback");t&&t.remove();let a=await r();if(a){document.getElementById("first-step").classList.add("d-none"),document.getElementById("email-recap").innerText=e.querySelector('[name="email"]').value,document.getElementById("second-step").classList.remove("d-none");let l=document.querySelector(".menu-wrapper");l&&l.scrollIntoView({behavior:"smooth"})}else{let i=function e(){let t=document.createElement("p");t.classList.add("form-feedback","just-validate-error-label","ms-0"),t.innerText="something went wrong, try again";let r=document.createElement("div");return r.classList.add("errorFeedback"),r.appendChild(t),r}(),o=n.querySelector(".privacy-wrapper");if(!o)return;n.insertBefore(i,o)}}))}e&&n()}();